---
title: "Set Context"
api: "POST /voice/api/v1/vapi/set-context"
description: "Create a payment session and get the transfer destination for a Vapi call"
---

Create a payment session for a Vapi voice AI agent. The response includes the phone number and `transfer_destination` your agent should use with Vapi's `transferCall` function. Maven matches the caller by phone number and begins payment collection.

This endpoint accepts both flat JSON and Vapi's server-tool envelope format.

## Request Body

### Required

<ParamField body="project" type="string" required>
  Project ID or slug (e.g., `my-app`).
</ParamField>

<ParamField body="caller" type="string" required>
  Customer's phone number in E.164 format (e.g., `+14155551234`). When using the Vapi envelope format, this is automatically extracted from `message.customer.number` if not provided in the tool arguments.
</ParamField>

<ParamField body="amount" type="number" required>
  Amount in cents (e.g., `2500` for $25.00). Must be 0 or greater.
</ParamField>

### Optional

<ParamField body="mode" type="string" default="charge">
  Payment mode: `charge` (immediate payment) or `tokenize` (save card for later).
</ParamField>

<ParamField body="description" type="string">
  Payment description shown on the customer's card statement.
</ParamField>

<ParamField body="customer_id" type="string">
  Your internal customer identifier for correlation.
</ParamField>

<ParamField body="full_name" type="string">
  Customer's full name.
</ParamField>

<ParamField body="email" type="string">
  Customer's email address. Used for receipt delivery if enabled.
</ParamField>

<ParamField body="callback" type="string">
  Transfer-back SIP URI. If not set, uses the project default.
</ParamField>

<ParamField body="memory" type="string">
  Context to share with the agent on transfer-back (max 2000 chars). Use this to pass conversation context like order details or customer preferences.
</ParamField>

<ParamField body="metadata" type="object">
  Custom key-value data attached to the session. Returned in API responses.
</ParamField>

## Response

<ResponseField name="session_id" type="string">
  Unique session identifier (UUID).
</ResponseField>

<ResponseField name="status" type="string">
  Initial session status: `created`.
</ResponseField>

<ResponseField name="ivr_phone_number" type="string">
  Maven phone number.
</ResponseField>

<ResponseField name="transfer_destination" type="string">
  Phone number to use with Vapi's `transferCall` function. Same as `ivr_phone_number`.
</ResponseField>

<ResponseField name="provider" type="string">
  Always `vapi`.
</ResponseField>

<ResponseField name="instructions" type="string">
  Human-readable instructions for the agent on what to do next.
</ResponseField>

<RequestExample>

```bash cURL
curl -X POST https://api.trymaven.com/voice/api/v1/vapi/set-context \
  -H "Authorization: Bearer mvn_live_your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "project": "my-app",
    "caller": "+14155551234",
    "amount": 2500,
    "mode": "charge",
    "description": "Order #12345",
    "customer_id": "cust_123",
    "full_name": "Jane Smith",
    "email": "jane@example.com",
    "callback": "sip:agent@your-sip-provider.com",
    "memory": "Customer wants to pay for order #12345. They prefer email receipt.",
    "metadata": { "order_id": "12345" }
  }'
```

```javascript Node.js
const response = await fetch('https://api.trymaven.com/voice/api/v1/vapi/set-context', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer mvn_live_your_api_key',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    project: 'my-app',
    caller: '+14155551234',
    amount: 2500,
    mode: 'charge',
    description: 'Order #12345',
    customer_id: 'cust_123',
    full_name: 'Jane Smith',
    email: 'jane@example.com',
    callback: 'sip:agent@your-sip-provider.com',
    memory: 'Customer wants to pay for order #12345. They prefer email receipt.',
    metadata: { order_id: '12345' }
  })
});

const result = await response.json();
// Use result.transfer_destination with Vapi's transferCall function
```

```python Python
import requests

response = requests.post(
    'https://api.trymaven.com/voice/api/v1/vapi/set-context',
    headers={'Authorization': 'Bearer mvn_live_your_api_key'},
    json={
        'project': 'my-app',
        'caller': '+14155551234',
        'amount': 2500,
        'mode': 'charge',
        'description': 'Order #12345',
        'customer_id': 'cust_123',
        'full_name': 'Jane Smith',
        'email': 'jane@example.com',
        'callback': 'sip:agent@your-sip-provider.com',
        'memory': 'Customer wants to pay for order #12345. They prefer email receipt.',
        'metadata': {'order_id': '12345'}
    }
)

result = response.json()
# Use result['transfer_destination'] with Vapi's transferCall function
```

</RequestExample>

<ResponseExample>

```json Response
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "created",
  "ivr_phone_number": "+14085551234",
  "transfer_destination": "+14085551234",
  "provider": "vapi",
  "instructions": "Use the transferCall function to transfer to +14085551234. Maven will collect payment and transfer back with results in SIP headers (x_maven_status, x_maven_amount, etc.)."
}
```

</ResponseExample>

---

<Accordion title="Vapi Server-Tool Envelope Format">
  When used as a Vapi server tool, Vapi wraps the request in an envelope. Maven automatically extracts the tool call arguments and caller number:

  ```json
  {
    "message": {
      "customer": { "number": "+14155551234" },
      "toolCalls": [
        {
          "id": "call_abc123",
          "function": {
            "name": "SendContextToMaven",
            "arguments": {
              "project": "my-app",
              "amount": 2500,
              "mode": "charge",
              "description": "Order #12345"
            }
          }
        }
      ]
    }
  }
  ```

  Maven responds in Vapi's expected format:

  ```json
  {
    "results": [
      {
        "toolCallId": "call_abc123",
        "result": {
          "session_id": "550e8400-e29b-41d4-a716-446655440000",
          "status": "created",
          "ivr_phone_number": "+14085551234",
          "transfer_destination": "+14085551234",
          "provider": "vapi",
          "instructions": "Use the transferCall function to transfer to +14085551234."
        }
      }
    ]
  }
  ```
</Accordion>
