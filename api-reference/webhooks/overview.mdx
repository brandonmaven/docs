---
title: Webhooks
sidebarTitle: "Overview"
description: "Receive real-time payment notifications"
---

Maven sends webhooks to notify your server when payment events occur. Configure a webhook URL per project in the [dashboard](https://app.trymaven.com) project settings.

## Configuration

1. Go to your project settings in the dashboard
2. Enter your webhook endpoint URL
3. Copy the generated webhook secret for signature verification

## Event Types

| Event | Description |
|-------|-------------|
| `payment.success` | Payment completed successfully |
| `payment.failed` | Payment failed or checkout expired |
| `payment.tokenized` | Card saved for later use (tokenize mode) |
| `payment.refunded` | Payment was refunded |
| `payment.disputed` | Payment was disputed (chargeback) |
| `session.status_changed` | Session status transition |
| `session.transferring` | Call is about to be transferred back to the callback number |

## Payload Examples

### payment.success

Sent when a payment (charge mode) completes successfully.

```json
{
  "event_type": "payment.success",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T10:35:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "description": "Order #12345",
  "status": "payment-success",
  "charge_id": "ch_3PqR7sK2x...",
  "card_brand": "visa",
  "card_last4": "4242",
  "receipt_url": "https://pay.stripe.com/receipts/...",
  "customer_id": "cust_123",
  "customer_name": "Jane Smith",
  "customer_email": "jane@example.com",
  "metadata": {"order_id": "12345"}
}
```

### payment.failed

Sent when a payment attempt fails or an SMS checkout expires.

```json
{
  "event_type": "payment.failed",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T10:35:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "description": "Order #12345",
  "status": "payment-failed",
  "error_code": "card_declined",
  "error_message": "Your card was declined.",
  "customer_id": null,
  "metadata": {"order_id": "12345"}
}
```

### payment.tokenized

Sent when a card is saved (tokenize mode).

```json
{
  "event_type": "payment.tokenized",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T10:35:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 0,
  "currency": "USD",
  "description": "Save card",
  "status": "payment-success",
  "card_brand": "visa",
  "card_last4": "4242",
  "payment_method_id": "pm_1PqR7sK2x...",
  "customer_id": null,
  "customer_name": "Jane Smith",
  "customer_email": "jane@example.com",
  "metadata": {}
}
```

### payment.refunded

Sent when a charge is refunded on your connected Stripe account.

```json
{
  "event_type": "payment.refunded",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T12:00:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "refund_amount_cents": 2500,
  "charge_id": "ch_3PqR7sK2x...",
  "refund_id": "re_1PqR7sK2x...",
  "reason": "requested_by_customer",
  "customer_id": null,
  "metadata": {"order_id": "12345"}
}
```

### payment.disputed

Sent when a dispute (chargeback) is opened against a charge.

```json
{
  "event_type": "payment.disputed",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T12:00:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "dispute_amount_cents": 2500,
  "charge_id": "ch_3PqR7sK2x...",
  "dispute_id": "dp_1PqR7sK2x...",
  "reason": "fraudulent",
  "customer_id": null,
  "metadata": {"order_id": "12345"}
}
```

### session.status_changed

Sent on any session status transition.

```json
{
  "event_type": "session.status_changed",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T10:30:30Z",
  "status": "collecting",
  "previous_status": "created",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "description": "Order #12345",
  "metadata": {}
}
```

### session.transferring

Sent right before the call is transferred back to the callback number. Use this to prepare your voice agent with payment context before resuming the conversation.

```json
{
  "event_type": "session.transferring",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2026-02-11T10:35:01Z",
  "caller_phone": "+14155551234",
  "transfer_to": "+18005551234",
  "amount_cents": 2500,
  "currency": "USD",
  "status": "payment-success",
  "card_brand": "visa",
  "card_last4": "4242",
  "customer_id": null,
  "metadata": {"order_id": "12345"}
}
```

## Headers

All webhook requests include these headers:

| Header | Description | Example |
|--------|-------------|---------|
| `Content-Type` | Always JSON | `application/json` |
| `X-Maven-Event` | Event type | `payment.success` |
| `X-Maven-Timestamp` | Unix timestamp | `1739270100` |
| `X-Maven-Signature` | HMAC-SHA256 signature | `a1b2c3d4e5f6...` |

## Signature Verification

Verify the `X-Maven-Signature` header to ensure the webhook came from Maven. The signature is computed as an HMAC-SHA256 hex digest of the raw request body using your project's webhook secret.

<CodeGroup>

```javascript Node.js
const crypto = require('crypto');

function verifyWebhook(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');

  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expectedSignature)
  );
}

// Express.js example
app.post('/webhook', express.raw({type: 'application/json'}), (req, res) => {
  const signature = req.headers['x-maven-signature'];

  if (!verifyWebhook(req.body, signature, process.env.WEBHOOK_SECRET)) {
    return res.status(401).send('Invalid signature');
  }

  const event = JSON.parse(req.body);

  switch (event.event_type) {
    case 'payment.success':
      // Handle successful payment
      break;
    case 'payment.failed':
      // Handle failed payment
      break;
  }

  res.status(200).send('OK');
});
```

```python Python
import hmac
import hashlib
import json

def verify_webhook(payload_body: bytes, signature: str, secret: str) -> bool:
    expected = hmac.new(
        secret.encode(),
        payload_body,
        hashlib.sha256
    ).hexdigest()
    return hmac.compare_digest(expected, signature)

# FastAPI example
from fastapi import FastAPI, Request, HTTPException

app = FastAPI()

@app.post("/webhook")
async def handle_webhook(request: Request):
    body = await request.body()
    signature = request.headers.get("x-maven-signature", "")

    if not verify_webhook(body, signature, WEBHOOK_SECRET):
        raise HTTPException(status_code=401, detail="Invalid signature")

    event = json.loads(body)

    if event["event_type"] == "payment.success":
        # Handle successful payment
        pass
    elif event["event_type"] == "payment.failed":
        # Handle failed payment
        pass

    return {"status": "ok"}
```

</CodeGroup>

## Retry Policy

Maven retries failed webhook deliveries up to 5 times with exponential backoff:

| Attempt | Delay |
|---------|-------|
| 1 | Immediate |
| 2 | 30 seconds |
| 3 | 1 minute |
| 4 | 2 minutes |
| 5 | 4 minutes |

Webhooks are considered failed if:
- Response status is not 2xx
- Connection times out (10 seconds)
- Connection is refused

## Best Practices

<AccordionGroup>
  <Accordion title="Return 200 quickly">
    Return a 200 response as soon as you receive the webhook. Process the event asynchronously if needed.
  </Accordion>

  <Accordion title="Handle duplicates">
    Webhooks may be delivered more than once. Use the `session_id` to deduplicate events.
  </Accordion>

  <Accordion title="Verify signatures">
    Always verify webhook signatures in production to ensure requests are from Maven.
  </Accordion>

  <Accordion title="Use HTTPS">
    Always use HTTPS endpoints for webhook URLs in production.
  </Accordion>
</AccordionGroup>
