---
title: Webhooks
description: "Receive real-time payment notifications"
---

# Webhooks

Maven sends webhooks to notify you of payment events in real-time.

## Setup

Configure your webhook URL in [Dashboard â†’ Projects](https://app.trymaven.com/projects).

## Events

| Event | Description |
|-------|-------------|
| `payment.success` | Payment completed successfully |
| `payment.failed` | Payment failed |
| `payment.tokenized` | Card saved (tokenize mode) |

## Headers

All webhooks include these headers:

| Header | Description |
|--------|-------------|
| `X-Maven-Event` | Event type (e.g., `payment.success`) |
| `X-Maven-Signature` | HMAC-SHA256 signature (if webhook secret configured) |
| `X-Maven-Timestamp` | Unix timestamp |

## Webhook Payloads

### payment.success

Sent when a payment is successfully charged.

```json
{
  "event_type": "payment.success",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2024-01-15T10:35:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "description": "Monthly subscription",
  "status": "payment-success",
  "charge_id": "ch_xxx",
  "card_brand": "visa",
  "card_last4": "4242",
  "receipt_url": "https://pay.stripe.com/receipts/...",
  "customer_id": "your-customer-123",
  "customer_name": "John Doe",
  "customer_email": "john@example.com",
  "metadata": {
    "order_id": "ORD-123"
  }
}
```

### payment.failed

Sent when a payment fails.

```json
{
  "event_type": "payment.failed",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2024-01-15T10:35:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "description": "Monthly subscription",
  "status": "payment-failed",
  "error_code": "card_declined",
  "error_message": "Your card was declined",
  "customer_id": "your-customer-123",
  "metadata": {}
}
```

### payment.tokenized

Sent when a card is saved (tokenize mode).

```json
{
  "event_type": "payment.tokenized",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2024-01-15T10:35:00Z",
  "caller_phone": "+14155551234",
  "amount_cents": 2500,
  "currency": "USD",
  "description": "Save card for later",
  "status": "payment-success",
  "card_brand": "visa",
  "card_last4": "4242",
  "token_id": "pm_xxx",
  "platform_token_id": "pm_xxx",
  "customer_id": "your-customer-123",
  "customer_name": "John Doe",
  "metadata": {}
}
```

## Verifying Webhooks

Webhooks include an HMAC-SHA256 signature in the `X-Maven-Signature` header. Verify it using your webhook secret (from dashboard):

```javascript
const crypto = require('crypto');

function verifyWebhook(payload, signature, secret) {
  const expected = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');

  return expected === signature;
}

// In your webhook handler
app.post('/webhook', express.raw({ type: 'application/json' }), (req, res) => {
  const signature = req.headers['x-maven-signature'];
  const payload = req.body.toString();

  const isValid = verifyWebhook(
    payload,
    signature,
    process.env.MAVEN_WEBHOOK_SECRET
  );

  if (!isValid) {
    return res.status(401).send('Invalid signature');
  }

  // Process webhook
  const data = JSON.parse(payload);
  console.log(`Received ${data.event_type} for session ${data.session_id}`);

  res.status(200).send('OK');
});
```

<Warning>
  Webhooks timeout after **10 seconds**. Return a 200 response immediately, then process asynchronously if needed.
</Warning>

## Best Practices

<AccordionGroup>
  <Accordion title="Return 200 quickly">
    Return a 200 response immediately, then process the webhook asynchronously. Webhooks timeout after 10 seconds.
  </Accordion>

  <Accordion title="Handle duplicates">
    Use `session_id` to deduplicate. The same event may be sent multiple times.
  </Accordion>

  <Accordion title="Verify signatures">
    Always verify the webhook signature in production to prevent spoofing.
  </Accordion>
</AccordionGroup>
