---
title: Twilio Integration
description: "Collect payments with Twilio voice"
---

# Twilio Integration

Integrate Maven with Twilio Voice in 3 steps.

## Quick Setup

<Steps>
  <Step title="Get your Maven API key">
    Go to [Dashboard â†’ API Keys](https://app.trymaven.com/api-keys) and create a key
  </Step>
  <Step title="Create a payment session">
    Call Maven's API with payment details
  </Step>
  <Step title="Transfer the call">
    Use TwiML to dial the returned phone number
  </Step>
</Steps>

---

## Step 1: Create Session

When you need to collect payment, call the Maven API:

<CodeGroup>

```python Python
import requests

response = requests.post(
    "https://api.trymaven.com/v1/sessions",
    headers={
        "Authorization": "Bearer mvn_test_xxx",
        "Content-Type": "application/json"
    },
    json={
        "project": "my-project",
        "caller": "+14155551234",  # Customer's phone
        "amount": 2500,            # $25.00 in cents
        "currency": "USD",
        "callback": "+14155559999" # Optional: transfer back after
    }
)

phone_number = response.json()["phone_number"]
```

```javascript Node.js
const response = await fetch("https://api.trymaven.com/v1/sessions", {
  method: "POST",
  headers: {
    "Authorization": "Bearer mvn_test_xxx",
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    project: "my-project",
    caller: "+14155551234",
    amount: 2500,
    currency: "USD",
    callback: "+14155559999"
  })
});

const { phone_number } = await response.json();
```

</CodeGroup>

## Step 2: Transfer the Call

Return TwiML to transfer the customer to Maven's IVR:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Response>
  <Say>I'll transfer you now to enter your card details.</Say>
  <Dial>
    <Number>+14085551234</Number>  <!-- phone_number from Step 1 -->
  </Dial>
</Response>
```

That's it! The customer enters their card via phone keypad, Maven processes the payment.

## Step 3: Get Payment Result

Maven sends a webhook when payment completes. Configure your webhook URL in the [Maven Dashboard](https://app.trymaven.com/projects).

```json
{
  "event": "payment.success",
  "session_id": "abc-123",
  "amount": 2500,
  "currency": "USD",
  "card_brand": "visa",
  "card_last4": "4242"
}
```

<Tip>
  If you set a `callback` number, Maven transfers the customer back automatically after payment.
</Tip>

---

## Testing

1. Use a `mvn_test_` API key (test mode)
2. When prompted for card, enter: `4242 4242 4242 4242`
3. Any future expiry date, any 3-digit CVV

<Info>
  Test mode simulates charges. No real money moves.
</Info>

---

## Full Server Example

Here's a complete Express.js server that handles the full flow:

```javascript
const express = require('express');
const app = express();

app.use(express.urlencoded({ extended: true }));

// POST /twilio/collect-payment?amount=25.00
app.post('/twilio/collect-payment', async (req, res) => {
  const { From } = req.body;
  const amount = parseFloat(req.query.amount || '0');

  if (!amount || amount <= 0) {
    res.type('text/xml');
    return res.send(`
      <Response>
        <Say>I'm sorry, there was an error with the payment amount.</Say>
      </Response>
    `);
  }

  // Create Maven session
  const session = await fetch('https://api.trymaven.com/v1/sessions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.MAVEN_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      project: 'my-project',
      caller: From,
      amount: Math.round(amount * 100),
      currency: 'USD',
      callback: process.env.TWILIO_PHONE_NUMBER
    })
  });

  const { phone_number } = await session.json();

  res.type('text/xml');
  res.send(`
    <?xml version="1.0" encoding="UTF-8"?>
    <Response>
      <Say>I'll transfer you now to enter your card details.</Say>
      <Dial action="/twilio/transfer-complete">
        <Number>${phone_number}</Number>
      </Dial>
    </Response>
  `);
});

// Handle transfer completion
app.post('/twilio/transfer-complete', (req, res) => {
  const { DialCallStatus } = req.body;

  res.type('text/xml');

  if (DialCallStatus === 'completed') {
    res.send(`
      <?xml version="1.0" encoding="UTF-8"?>
      <Response>
        <Say>Thank you for your payment. Goodbye!</Say>
      </Response>
    `);
  } else {
    res.send(`
      <?xml version="1.0" encoding="UTF-8"?>
      <Response>
        <Say>I'm sorry, the payment didn't go through. Please try again later.</Say>
      </Response>
    `);
  }
});

app.listen(3000);
```

---

## Twilio Studio

You can also use Twilio Studio to call Maven's API directly:

1. Add a **Make HTTP Request** widget
2. Configure it:
   - URL: `https://api.trymaven.com/v1/sessions`
   - Method: `POST`
   - Headers: `Authorization: Bearer YOUR_MAVEN_API_KEY`
   - Body: `{"project": "my-project", "caller": "{{contact.channel.address}}", "amount": 2500}`
3. Add a **Connect Call To** widget
4. Set number to: `{{widgets.create_session.parsed.phone_number}}`

<Warning>
  Your API key will be visible to anyone with Studio access. For production, use a server endpoint or Twilio Functions.
</Warning>

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="TwiML not working">
    Make sure your endpoint returns `Content-Type: text/xml` and valid TwiML.
  </Accordion>

  <Accordion title="Call not transferring">
    Check that the Maven session was created successfully. Log the `phone_number` to verify it's being returned.
  </Accordion>

  <Accordion title="Payment failing">
    In test mode, use card `4242 4242 4242 4242`. Check your Maven dashboard for session status.
  </Accordion>
</AccordionGroup>
