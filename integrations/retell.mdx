---
title: Retell Integration
description: "Collect payments with Retell voice agents"
---

# Retell Integration

Integrate Maven with Retell in minutes. No server required.

## Quick Setup (5 minutes)

<Steps>
  <Step title="Get your Maven API key">
    Go to [Dashboard â†’ API Keys](https://app.trymaven.com/api-keys) and create a key
  </Step>
  <Step title="Add the payment function to Retell">
    Configure a custom function in your Retell agent
  </Step>
  <Step title="Update your agent prompt">
    Tell your agent when to collect payment
  </Step>
</Steps>

## 1. Add Payment Function to Retell

In your Retell agent's **Custom Functions** section, add a new function:

**Function Name:** `collect_payment`

**Description:** `Transfer the customer to securely collect their credit card payment`

**URL:** `https://api.trymaven.com/v1/integrations/retell/webhook`

**Method:** POST

**Headers:**
```json
{
  "Authorization": "Bearer YOUR_MAVEN_API_KEY"
}
```

**Parameters:**
```json
{
  "type": "object",
  "properties": {
    "amount": {
      "type": "number",
      "description": "Payment amount in dollars (e.g., 25.00)"
    },
    "description": {
      "type": "string",
      "description": "What the payment is for (e.g., 'Monthly subscription')"
    },
    "mode": {
      "type": "string",
      "enum": ["charge", "tokenize"],
      "description": "Whether to charge immediately or just save the card for later"
    },
    "callback": {
      "type": "string",
      "description": "Phone number to transfer back to after payment"
    },
    "customer_id": {
      "type": "string",
      "description": "Your internal customer ID to associate with this payment"
    }
  },
  "required": ["amount"]
}
```

| Parameter | Required | Description |
|-----------|----------|-------------|
| `amount` | Yes | Payment amount in dollars |
| `description` | No | What the payment is for |
| `mode` | No | `charge` (default) or `tokenize` to just save card |
| `callback` | No | Phone number to transfer back to after payment |
| `customer_id` | No | Your internal customer ID |

<Warning>
  Replace `YOUR_MAVEN_API_KEY` with your actual API key (e.g., `mvn_test_xxx` or `mvn_live_xxx`)
</Warning>

## 2. Update Your Agent Prompt

Add this to your Retell agent's system prompt:

```
When the customer is ready to pay, use the collect_payment function with the amount.
The customer will be transferred to enter their card details securely.
After payment, they will be transferred back automatically.
```

## 3. Set Up Webhook (Optional)

To receive payment notifications, configure a webhook in your [Maven Dashboard](https://app.trymaven.com/projects).

Maven will POST to your webhook URL:

```json
{
  "event": "payment.success",
  "session_id": "abc-123",
  "amount": 2500,
  "currency": "USD",
  "card_brand": "visa",
  "card_last4": "4242"
}
```

## That's It!

Your Retell agent can now collect payments. When the agent calls `collect_payment`:

1. Maven creates a payment session
2. Retell transfers the call to Maven's secure IVR
3. Customer enters card via phone keypad
4. Maven charges the card and sends you a webhook
5. Call transfers back to your agent (optional)

---

## Testing

1. Use a `mvn_test_` API key (test mode)
2. When prompted for card, enter: `4242 4242 4242 4242`
3. Any future expiry date, any 3-digit CVV

<Info>
  Test mode simulates charges. No real money moves.
</Info>

---

## Advanced: Transfer Back

To transfer the customer back to your Retell agent after payment, add a `callback` parameter:

```json
{
  "type": "object",
  "properties": {
    "amount": { "type": "number" },
    "callback": {
      "type": "string",
      "description": "Phone number to transfer back to after payment"
    }
  }
}
```

Your agent would call it like:
```
collect_payment(amount: 25.00, callback: "+14155551234")
```

---

## Advanced: Custom Server

If you need more control (custom logic, database lookups, etc.), you can run your own server:

```javascript
// Your server handles the Retell function call
app.post('/retell/payment', async (req, res) => {
  const { args, call } = req.body;
  const caller = call.from_number;

  // Your custom logic here...
  const customerId = await lookupCustomer(caller);

  // Create Maven session
  const session = await fetch('https://api.trymaven.com/v1/sessions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.MAVEN_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      project: 'my-project',
      caller: caller,
      amount: args.amount * 100,
      customer_id: customerId,
      metadata: { source: 'retell' }
    })
  });

  const { phone_number } = await session.json();

  return res.json({
    response: 'Transferring to secure payment line.',
    transfer_to: phone_number
  });
});
```

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="Function not working">
    Check that your Maven API key is correct in the function headers. Make sure it starts with `mvn_test_` or `mvn_live_`.
  </Accordion>

  <Accordion title="Call not transferring">
    Retell should automatically handle the `transfer_to` field in the response. Check the Retell logs to see if the function response is being received.
  </Accordion>

  <Accordion title="Payment failing">
    In test mode, use card `4242 4242 4242 4242`. Check your Maven dashboard for session status and error details.
  </Accordion>
</AccordionGroup>
