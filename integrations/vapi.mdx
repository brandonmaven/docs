---
title: VAPI Integration
description: "Collect payments with VAPI voice agents"
---

# VAPI Integration

Integrate Maven with VAPI in minutes. No server required.

## Quick Setup (5 minutes)

<Steps>
  <Step title="Get your Maven API key">
    Go to [Dashboard â†’ API Keys](https://app.trymaven.com/api-keys) and create a key
  </Step>
  <Step title="Add the payment tool to VAPI">
    Copy the tool config below into your VAPI assistant
  </Step>
  <Step title="Update your assistant prompt">
    Tell your assistant when to collect payment
  </Step>
</Steps>

## 1. Add Payment Tool to VAPI

In your VAPI assistant's **Tools** section, add this tool:

```json
{
  "type": "function",
  "function": {
    "name": "collect_payment",
    "description": "Transfer the customer to securely collect their credit card payment",
    "parameters": {
      "type": "object",
      "properties": {
        "amount": {
          "type": "number",
          "description": "Payment amount in dollars (e.g., 25.00)"
        },
        "description": {
          "type": "string",
          "description": "What the payment is for (e.g., 'Monthly subscription')"
        },
        "mode": {
          "type": "string",
          "enum": ["charge", "tokenize"],
          "description": "Whether to charge immediately or just save the card for later"
        },
        "callback": {
          "type": "string",
          "description": "Phone number to transfer back to after payment (e.g., '+14155551234')"
        },
        "customer_id": {
          "type": "string",
          "description": "Your internal customer ID to associate with this payment"
        }
      },
      "required": ["amount"]
    }
  },
  "server": {
    "url": "https://api.trymaven.com/v1/integrations/vapi/webhook",
    "headers": {
      "Authorization": "Bearer YOUR_MAVEN_API_KEY"
    }
  }
}
```

<Warning>
  Replace `YOUR_MAVEN_API_KEY` with your actual API key (e.g., `mvn_test_xxx` or `mvn_live_xxx`)
</Warning>

## 2. Update Your Assistant Prompt

Add this to your VAPI assistant's system prompt:

```
When the customer is ready to pay, use the collect_payment tool with the amount.
The customer will be transferred to enter their card details securely.
After payment, they will be transferred back automatically.
```

## 3. Set Up Webhook (Optional)

To receive payment notifications, configure a webhook in your [Maven Dashboard](https://app.trymaven.com/projects).

Maven will POST to your webhook URL:

```json
{
  "event": "payment.success",
  "session_id": "abc-123",
  "amount": 2500,
  "currency": "USD",
  "card_brand": "visa",
  "card_last4": "4242"
}
```

## That's It!

Your VAPI assistant can now collect payments. When the assistant calls `collect_payment`:

1. Maven creates a payment session
2. VAPI transfers the call to Maven's secure IVR
3. Customer enters card via phone keypad
4. Maven charges the card and sends you a webhook
5. Call transfers back to your assistant (optional)

---

## Testing

1. Use a `mvn_test_` API key (test mode)
2. When prompted for card, enter: `4242 4242 4242 4242`
3. Any future expiry date, any 3-digit CVV

<Info>
  Test mode simulates charges. No real money moves.
</Info>

---

## Advanced: Transfer Back

To transfer the customer back to your VAPI assistant after payment, add a `callback` parameter:

```json
{
  "function": {
    "name": "collect_payment",
    "parameters": {
      "properties": {
        "amount": { "type": "number" },
        "callback": {
          "type": "string",
          "description": "Phone number to transfer back to after payment"
        }
      }
    }
  }
}
```

Your assistant would call it like:
```
collect_payment(amount: 25.00, callback: "+14155551234")
```

---

## Advanced: Custom Server

If you need more control (custom logic, database lookups, etc.), you can run your own server:

```javascript
// Your server handles the VAPI webhook
app.post('/vapi/payment', async (req, res) => {
  const { message } = req.body;
  const amount = message.toolCalls[0].function.arguments.amount;
  const caller = message.call.customer.number;

  // Your custom logic here...
  const customerId = await lookupCustomer(caller);

  // Create Maven session
  const session = await fetch('https://api.trymaven.com/v1/sessions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.MAVEN_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      project: 'my-project',
      caller: caller,
      amount: amount * 100,
      customer_id: customerId,
      metadata: { source: 'vapi' }
    })
  });

  const { phone_number } = await session.json();

  return res.json({
    results: [{ toolCallId: message.toolCalls[0].id, result: 'Transferring...' }],
    destination: { type: 'number', number: phone_number }
  });
});
```

---

## Troubleshooting

<AccordionGroup>
  <Accordion title="Tool not working">
    Check that your Maven API key is correct in the tool's server headers. Make sure it starts with `mvn_test_` or `mvn_live_`.
  </Accordion>

  <Accordion title="Call not transferring">
    Maven returns a `destination` object that tells VAPI to transfer. Check the VAPI logs to see if the tool response is being received.
  </Accordion>

  <Accordion title="Payment failing">
    In test mode, use card `4242 4242 4242 4242`. Check your Maven dashboard for session status and error details.
  </Accordion>
</AccordionGroup>
