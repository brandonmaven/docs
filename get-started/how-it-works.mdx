---
title: How It Works
description: "Understand the Maven voice payment flow"
---

## Payment Flow

<Steps>
  <Step title="Create a session">
    Your server calls `POST /v1/sessions` with the payment details. Maven returns an IVR phone number.
  </Step>
  <Step title="Transfer the call">
    Your voice agent transfers the customer to the Maven IVR number. The customer enters their card details using their phone keypad (DTMF).
  </Step>
  <Step title="Payment processes">
    Maven tokenizes the card (PCI-compliant) and processes the charge on your connected Stripe account.
  </Step>
  <Step title="Call transfers back">
    If you provided a `callback` number, Maven transfers the customer back to your agent after payment.
  </Step>
</Steps>

## Input Modes

| Mode | Description | Status |
|------|-------------|--------|
| `dtmf` (default) | Customer enters card digits using the phone keypad | Available |
| `asr` | Customer speaks card digits using voice recognition | Coming soon |

DTMF is the default and recommended input mode. It works reliably on all phones.

## Callback (Transfer Back)

To have Maven transfer the customer back to your agent after payment, include a `callback` phone number in the session request.

```json
{
  "project": "my-app",
  "caller": "+14155551234",
  "amount": 2500,
  "mode": "charge",
  "callback": "+18005551234"
}
```

## Session Lifecycle

Sessions expire after **10 minutes** if the customer doesn't call the IVR number. Creating a new session for the same phone number automatically cancels any previous active session.

```
created --> collecting --> processing --> payment-success
  |             |                    \-> payment-failed
  \-> expired   \-> cancelled
  \-> cancelled
```

## Get Payment Result

After the call transfers back, look up the payment result by the caller's phone number. This is the simplest approach since your transfer-back agent already knows the caller.

<CodeGroup>

```javascript Node.js
async function getPaymentResult(callerPhone, apiKey) {
  const res = await fetch(
    `https://api.trymaven.com/v1/sessions?caller=${encodeURIComponent(callerPhone)}`,
    { headers: { 'Authorization': `Bearer ${apiKey}` } }
  );
  const sessions = await res.json();
  return sessions[0]; // Most recent session for this caller
}
```

```python Python
import requests

def get_payment_result(caller_phone: str, api_key: str):
    response = requests.get(
        'https://api.trymaven.com/v1/sessions',
        params={'caller': caller_phone},
        headers={'Authorization': f'Bearer {api_key}'}
    )
    sessions = response.json()
    return sessions[0]  # Most recent session for this caller
```

</CodeGroup>

You can also poll by session ID if you stored it when creating the session:

<CodeGroup>

```javascript Node.js
async function waitForPayment(sessionId, apiKey) {
  while (true) {
    const res = await fetch(`https://api.trymaven.com/v1/sessions/${sessionId}`, {
      headers: { 'Authorization': `Bearer ${apiKey}` }
    });
    const session = await res.json();

    if (session.is_terminal) {
      return session;
    }

    await new Promise(r => setTimeout(r, 2000)); // Poll every 2 seconds
  }
}
```

```python Python
import time
import requests

def wait_for_payment(session_id: str, api_key: str):
    while True:
        response = requests.get(
            f'https://api.trymaven.com/v1/sessions/{session_id}',
            headers={'Authorization': f'Bearer {api_key}'}
        )
        session = response.json()

        if session['is_terminal']:
            return session

        time.sleep(2)  # Poll every 2 seconds
```

</CodeGroup>
