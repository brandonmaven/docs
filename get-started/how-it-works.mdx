---
title: How It Works
description: "Understand the Maven voice payment flow"
---

## Payment Flow

<Steps>
  <Step title="Create a session">
    Your server calls `POST /v1/sessions` with the payment details. Maven returns an IVR phone number.
  </Step>
  <Step title="Transfer the call">
    Your voice agent transfers the customer to the Maven IVR number. The customer enters their card details using their phone keypad (DTMF).
  </Step>
  <Step title="Payment processes">
    Maven tokenizes the card (PCI-compliant) and processes the charge on your connected Stripe account.
  </Step>
  <Step title="Call transfers back">
    If you provided a `callback` number, Maven transfers the customer back to your agent after payment.
  </Step>
</Steps>

## Transfer Methods

How you transfer the call to Maven depends on your voice platform.

### SIP Transfer (Recommended)

SIP transfers are the fastest and support passing payment context back via SIP headers when the call returns.

```
sip:+14085551234@your-provider.sip.twilio.com
```

When Maven transfers the call back, it includes context in SIP headers:

| SIP Header | Description |
|------------|-------------|
| `x_maven_session_id` | Payment session UUID |
| `x_maven_status` | `payment-success` or `payment-failed` |
| `x_maven_amount` | Amount in dollars (e.g., `25.00`) |
| `x_maven_card_last4` | Last 4 digits of card (success only) |
| `x_maven_card_brand` | Card brand like `visa` (success only) |
| `x_maven_error` | Error code (failure only) |

### PSTN Transfer (Cold Transfer)

Transfer the customer to the Maven phone number returned in the session response. This works with any telephony provider.

```
+14085551234
```

<Note>
  PSTN transfers don't support SIP headers, so you'll need to poll the session status to get payment results. See [Polling for Status](#polling-for-status) below.
</Note>

## Input Modes

| Mode | Description | Status |
|------|-------------|--------|
| `dtmf` (default) | Customer enters card digits using the phone keypad | Available |
| `asr` | Customer speaks card digits using voice recognition | Coming soon |

DTMF is the default and recommended input mode. It works reliably on all phones.

## Callback (Transfer Back)

To have Maven transfer the customer back to your agent after payment, include a `callback` phone number or SIP URI in the session request.

```json
{
  "project": "my-app",
  "caller": "+14155551234",
  "amount": 2500,
  "mode": "charge",
  "callback": "+18005551234"
}
```

## Session Lifecycle

Sessions expire after **10 minutes** if the customer doesn't call the IVR number. Creating a new session for the same phone number automatically cancels any previous active session.

```
created --> collecting --> processing --> payment-success
  |             |                    \-> payment-failed
  \-> expired   \-> cancelled
  \-> cancelled
```

## Polling for Status

Use the GET session endpoint to check payment status. Poll until `is_terminal` is `true`:

<CodeGroup>

```javascript Node.js
async function waitForPayment(sessionId, apiKey) {
  while (true) {
    const res = await fetch(`https://api.trymaven.com/v1/sessions/${sessionId}`, {
      headers: { 'Authorization': `Bearer ${apiKey}` }
    });
    const session = await res.json();

    if (session.is_terminal) {
      return session;
    }

    await new Promise(r => setTimeout(r, 2000)); // Poll every 2 seconds
  }
}
```

```python Python
import time
import requests

def wait_for_payment(session_id: str, api_key: str):
    while True:
        response = requests.get(
            f'https://api.trymaven.com/v1/sessions/{session_id}',
            headers={'Authorization': f'Bearer {api_key}'}
        )
        session = response.json()

        if session['is_terminal']:
            return session

        time.sleep(2)  # Poll every 2 seconds
```

</CodeGroup>
